# Results

## Question 1: What are the top 5 causes of death in our mortality dataset compared to the top 10 causes of death online or in common sense?

```{r}
disease.split<-aggregate(Deaths~Cause.of.death,data=df,sum)
disease.split<-arrange(disease.split, desc(Deaths))[1:5,]
fivedisease<-unique(disease.split$Cause.of.death)
barplot(disease.split$Deaths,names.arg=disease.split$Cause.of.death,horiz = TRUE,main="Total Death")
S_death<-aggregate(Deaths~State,data=df,sum)
S_death<-arrange(S_death,Deaths)
barplot(S_death$Deaths,names.arg=S_death$State,horiz = TRUE,main="State total Death")
S_death_dis<-aggregate(Deaths~State+Cause.of.death,data=df,sum)
S_death_dis<-S_death_dis[S_death_dis$Cause.of.death==fivedisease,]
state_dis.split<-split(S_death_dis,S_death_dis$State)
max<-function(df){
  return(df[which.max(df$Deaths),])
}
state_dis<-sapply(state_dis.split,max)
state_dis<-as.matrix(t(state_dis))
ggplot(S_death_dis, aes(x = State, y = Deaths, group = Cause.of.death),ordered=TRUE) + 
  geom_col(aes(fill=Cause.of.death)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.25)) +
  coord_flip()
```

The top five disease that lead to death is "COVID-19", "Atherosclerotic heart disease", "Bronchus or lung, unspecified - Malignant neoplasms", "Alzheimer disease, unspecified", "Chronic obstructive pulmonary disease, unspecified" .
The top five state that have most death is California, Texas, Florida, New York, Pennsylvanina


```{r}
df$DeathRate<-df$Deaths/df$Population*100000
disease.split<-aggregate(DeathRate~Cause.of.death,data=df,sum)
disease.split<-arrange(disease.split, desc(DeathRate))[1:5,]
fivediseaseRate<-unique(disease.split$Cause.of.death)
barplot(disease.split$DeathRate,names.arg=disease.split$Cause.of.death,horiz = TRUE,main="Total Death Rate")
S_death_rate<-aggregate(DeathRate~State,data=df,sum)
S_death_rate<-arrange(S_death_rate,DeathRate)
barplot(S_death_rate$DeathRate,names.arg=S_death$State,horiz = TRUE,main="State total Deathrate")
S_death_dis<-aggregate(DeathRate~State+Cause.of.death,data=df,sum)
S_death_dis<-S_death_dis[S_death_dis$Cause.of.death==fivediseaseRate, ]
state_dis.split<-split(S_death_dis,S_death_dis$State)
max<-function(df){
  return(df[which.max(df$DeathRate),])
}
state_dis<-sapply(state_dis.split,max)
state_dis<-t(state_dis)
ggplot(S_death_dis, aes(x = State, y = DeathRate, group = Cause.of.death),ordered=TRUE) + 
  geom_col(aes(fill=Cause.of.death)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.25)) +
  coord_flip()
```

The top five disease that lead to highest death rate is "COVID-19", "Atherosclerotic heart disease", "Bronchus or lung, unspecified - Malignant neoplasms", "Alzheimer disease, unspecified", "Chronic obstructive pulmonary disease, unspecified", which is same as previous.
The top five state that have most death is West Virginia, Mississippi, Alabama, Ohio, Pennsylvanina

## Question 2: What are the growth rates for these 5 causes of deaths for different identity groups in New York State for the previous 10 years?

### Female top 5 causes of death trend 

```{r}
# Find the rate
data.2$Rate <- (data.2$Deaths/data.2$Population)*100000

# Female 

# Find the descending order causes of death using average rate by year.
data2a <- data.2 %>%
  filter(Gender == "Female") %>%
  group_by(Cause.of.death) %>%
  mutate(AvgRate = mean(Rate)) %>%
  arrange(desc(AvgRate))
  
# We remove first row of COVID-19 value since it appears in 2020
# Then, find the top 5 causes of death using slice()
data2b <- data2a[-c(1),]
data2c <- data2b %>%
  group_by(Year) %>%
  slice(1:5)
  
# Draw the plot for Female
ggplot(data2c, aes(Year, Rate, color = Cause.of.death)) + 
  geom_line() +
  ylim(20, 106) +
  scale_x_continuous(breaks = seq(2011, 2020, 1)) +
  ggtitle("5 top causes of death for Female from 2011 to 2020 in NY")
```

### Male top 5 causes of death trend

```{r}

# Male 

# Find the descending order causes of death using average rate by year.
data2d <- data.2 %>%
  filter(Gender == "Male") %>%
  group_by(Cause.of.death) %>%
  mutate(AvgRate = mean(Rate)) %>%
  arrange(desc(AvgRate))
  
# We remove first row of COVID-19 value since it appears in 2020
# Then, find the top 5 causes of death using slice()
data2e <- data2d[-c(1),]
data2f <- data2e %>%
  group_by(Year) %>%
  slice(1:5)
  
# Draw the plot for Male
ggplot(data2f, aes(Year, Rate, color = Cause.of.death)) + 
  geom_line() +
  scale_x_continuous(breaks = seq(2011,2020, 1)) +
  ggtitle("5 top causes of death for Male from 2011 to 2020 in NY")
```

For both male and female, Atherosclerotic heart disease is the top one cause of death. For female, unspecified dementia was in an increasing trend in the past 10 years. For male, "Atherosclerotic cardiovascular disease, so described" was increasing drastically in year 2019 and 2020. Also, although death rate of  "Chronic obstructive pulmonary disease, unspecified
M" is not as high as other top 4 causes of death, this still has above 20 per 100,000 of death rate, which all the humanbeings need to be careful about that.

## Question 3: What is the top 5 cause of death and what is the spread of this disease in the U.S by state in 2020?

```{r}
library(vcdExtra)
theme_heat <- theme_classic() +
  theme(axis.line = element_blank(),
        axis.ticks = element_blank())

df<-df[df$Cause.of.death==fivediseaseRate,]

ggplot(df, aes(State, Cause.of.death, fill = DeathRate)) + 
  geom_tile(color = "white") +
  coord_equal() + theme_heat
```

```{r}
library(dplyr)
library(tidyr)
library(tibble)
library(ggplot2)
library(choroplethr)
library(choroplethrMaps)
```

```{r}
death <- S_death %>% as.data.frame() %>% 
  transmute(region = tolower(`State`), value = Deaths)

state_choropleth(death,
                 title = "Deaths in each state",
                 legend = "Deaths")
```

```{r}
deathrate <- S_death_rate %>% as.data.frame() %>% 
  transmute(region = tolower(`State`), value = DeathRate)

state_choropleth(deathrate,
                 title = "Death Rate in each State",
                 legend = "Death Rate")
```

The highest death and highest death rate is different.



## Question 4: What is the decision tree of locations, race, gender for top 1 causes of death? 

### Find the top 1 cause of death: Atherosclerotic heart disease
```{r,warning=FALSE}
# install.packages("rpart.plot")
library(rpart)
library(rpart.plot)

# Import data
data4 <- read_tsv("Final Project Q4.txt", show_col_types = FALSE)
data4 <- na.omit(data4[,-1])
data4 <- data.frame(data4)

# Fin the death crude rate per 100,000
data4$Rate <- (data4$Deaths/data4$Population)*100000

# Find the descending order causes of death using average rate by year.
data4a <- data4 %>%
  group_by(Cause.of.death) %>%
  mutate(AvgRate = mean(Rate)) %>%
  arrange(desc(AvgRate))

 # Remove Covid-19 since it only appears in 2020
data4b <- data4a[-c(1),]

# Find the top 1 cause of death
data4c <- data4b %>%
  group_by(Year) %>%
  slice(1)

ggplot(data4c, aes(Year, Rate, color = Cause.of.death)) + 
  geom_line() +
  ylim(20, 106) +
  scale_x_continuous(breaks = seq(2011, 2020, 1)) +
  ggtitle("Top 1 causes of death for Female from 2011 to 2020 in NY")

# Atherosclerotic heart disease is the top cause of death in U.S for previous
# 10 years from 2011-2020.
```

### Build the decision tree based on previous finding

```{r}
# Select the variables we need
data4e$Rate <- (as.numeric(data4e$Deaths)/as.numeric(data4e$Population))*100000

data4e$Rate <- ifelse(data4e$Rate <= 25, "Low", ifelse(data4e$Rate < 1000 & data4e$Rate > 25, "Medium", ifelse(data4e$Rate >= 1000, "High", NA)))
data4f <- data4e %>% select(c(Census.Region.Code,Ten.Year.Age.Groups.Code,	
Gender.Code, Race,Rate))
  

# Create train/test set
  
create_train_test <- function(data, size = 0.8, train = TRUE) {
    n_row = nrow(data)
    total_row = size * n_row
    train_sample <- 1: total_row
    if (train == TRUE) {
        return (data[train_sample, ])
    } else {
        return (data[-train_sample, ])
    }
}

data4_train <- create_train_test(data4f, size = 0.8, train = TRUE)
data4_test <- create_train_test(data4f, size = 0.8, train = FALSE)

# Percentage of rate levels
prop.table(table(data4_train$Rate))

# Fit the model
fit <- rpart(Rate~., data = data4_train, method = 'class')
rpart.plot(fit, extra = 106)
```
