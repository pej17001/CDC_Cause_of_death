--- 
title: "Top 5 causes of death"
author: "Peilin Jing, Jing Wang"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction

 In the past decades, the habits and preferences of people have changed as time goes by. Before the 2000s, due to the lack of productivity and low level of hygiene, a significant amount of people died from plagues and infections. When antibiotics, such as penicillin, were found in the 2000 century, the fatality rate of plague and infections decreased dramatically. Because of the rapid development of modern medicine, more and more threatening diseases can now be cured. However, every coin has two sides. Technological development and the excess capacity of industry in modern society lead to a lot of new problems such as drug abuse and obesity. We are interested in doing research and analysis on the causes of death in the past ten years to see whether huge changes are occurring and remind the public that we need to pay more attention to the prevention of new deadly diseases.

Questions:

1. What are the top 5 causes of death in our mortality dataset compared to the top 10 causes of death online or in common sense?

2. What are the growth rates for these 5 causes of deaths for different identity groups in New York State for the previous 10 years?

3. What is the top 5 cause of death and what is the spread of this disease in the U.S by state in 2020?

4. What is the decision tree of locations, race, gender for top 1 causes of death?

<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data sources


<!--chapter:end:02-data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data transformation
```{r} 
library(plyr)
library(ggplot2)
library(tidyverse)
data1<-read.delim('Underlying Cause of Death, 1999-2020 (2).txt',header=T)
data2<-read.delim('Underlying Cause of Death, 1999-2020 (3).txt',header=T)
df<-rbind(data1,data2)
df<-na.omit(df)[,-1]
```

<!--chapter:end:03-cleaning.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Missing values
1. 
```{r}
library(mi) 
x <- missing_data.frame(df) 
image(x) 
library(redav) 
plot_missing(df, percent = TRUE)
```

<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results
1. 
```{r}
df<-na.omit(df)[,-1]
disease.split<-aggregate(Deaths~Cause.of.death,data=df,sum)
disease.split<-arrange(disease.split, desc(Deaths))[1:5,]
fivedisease<-unique(disease.split$Cause.of.death)
barplot(disease.split$Deaths,names.arg=disease.split$Cause.of.death,horiz = TRUE,main="Total Death")
S_death<-aggregate(Deaths~State,data=df,sum)
S_death<-arrange(S_death,Deaths)
barplot(S_death$Deaths,names.arg=S_death$State,horiz = TRUE,main="State total Death")
S_death_dis<-aggregate(Deaths~State+Cause.of.death,data=df,sum)
S_death_dis<-S_death_dis[S_death_dis$Cause.of.death==fivedisease,]
state_dis.split<-split(S_death_dis,S_death_dis$State)
max<-function(df){
  return(df[which.max(df$Deaths),])
}
state_dis<-sapply(state_dis.split,max)
state_dis<-as.matrix(t(state_dis))
state_dis
ggplot(S_death_dis, aes(x = State, y = Deaths, group = Cause.of.death),ordered=TRUE) + 
  geom_col(aes(fill=Cause.of.death)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.25)) +
  coord_flip()
```

The top five disease that lead to death is "COVID-19", "Atherosclerotic heart disease", "Bronchus or lung, unspecified - Malignant neoplasms", "Alzheimer disease, unspecified", "Chronic obstructive pulmonary disease, unspecified" .
The top five state that have most death is California, Texas, Florida, New York, Pennsylvanina

3. 
```{r}
df$DeathRate<-df$Deaths/df$Population*100000
disease.split<-aggregate(DeathRate~Cause.of.death,data=df,sum)
disease.split<-arrange(disease.split, desc(DeathRate))[1:5,]
fivediseaseRate<-unique(disease.split$Cause.of.death)
barplot(disease.split$DeathRate,names.arg=disease.split$Cause.of.death,horiz = TRUE,main="Total Death Rate")
S_death_rate<-aggregate(DeathRate~State,data=df,sum)
S_death_rate<-arrange(S_death_rate,DeathRate)
barplot(S_death_rate$DeathRate,names.arg=S_death$State,horiz = TRUE,main="State total Deathrate")
S_death_dis<-aggregate(DeathRate~State+Cause.of.death,data=df,sum)
S_death_dis<-S_death_dis[S_death_dis$Cause.of.death==fivediseaseRate, ]
state_dis.split<-split(S_death_dis,S_death_dis$State)
max<-function(df){
  return(df[which.max(df$DeathRate),])
}
state_dis<-sapply(state_dis.split,max)
state_dis<-t(state_dis)
state_dis
ggplot(S_death_dis, aes(x = State, y = DeathRate, group = Cause.of.death),ordered=TRUE) + 
  geom_col(aes(fill=Cause.of.death)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.25)) +
  coord_flip()
```

The top five disease that lead to highest death rate is "COVID-19", "Atherosclerotic heart disease", "Bronchus or lung, unspecified - Malignant neoplasms", "Alzheimer disease, unspecified", "Chronic obstructive pulmonary disease, unspecified", which is same as previous.
The top five state that have most death is West Virginia, Mississippi, Alabama, Ohio, Pennsylvanina

```{r}
library(vcdExtra)
theme_heat <- theme_classic() +
  theme(axis.line = element_blank(),
        axis.ticks = element_blank())

df<-df[df$Cause.of.death==fivediseaseRate,]

ggplot(df, aes(State, Cause.of.death, fill = DeathRate)) + 
  geom_tile(color = "white") +
  coord_equal() + theme_heat
```

```{r}
library(dplyr)
library(tidyr)
library(tibble)
library(ggplot2)
library(choroplethr)
library(choroplethrMaps)
```

```{r}
death <- S_death %>% as.data.frame() %>% 
  transmute(region = tolower(`State`), value = Deaths)

state_choropleth(death,
                 title = "Deaths in each state",
                 legend = "Deaths")
```

```{r}
deathrate <- S_death_rate %>% as.data.frame() %>% 
  transmute(region = tolower(`State`), value = DeathRate)

state_choropleth(deathrate,
                 title = "Death Rate in each State",
                 legend = "Death Rate")
```

The highest death and highest death rate is different.

<!--chapter:end:05-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component



<!--chapter:end:06-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:07-conclusion.Rmd-->

